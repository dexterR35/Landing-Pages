<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Odds Table</title>
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/2.0.7/css/dataTables.dataTables.min.css"
    />
    <style>
      :root {
        --red: #dc143c;
        --white: #fff;
        --gray: #333333e6;
        --blue: #0e3358;
        --button_color: linear-gradient(
          to right,
          hsla(0, 89%, 42%, 1) 0%,
          #751618
        );
        --text_color_second: #b9e2fff2;
        --shadow-sm: rgba(0, 0, 0, 0.15) 1.95px 1.95px 2.6px;
        --bg-offer: url(./png/bg/bg.jpg);
      }

      *,
      *::after,
      *::before {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      @font-face {
        font-family: "MontzRegular";
        src: url("./font/MontserratZ-Regular.ttf") format("truetype");
        font-weight: 400;
        font-style: normal;
      }

      @font-face {
        font-family: "MontzSemiBold";
        src: url("./font/MontserratZ-SemiBold.ttf") format("truetype");
        font-weight: 700;
        font-style: normal;
      }

      @font-face {
        font-family: "MontzBold";
        src: url("./font/MontserratZ-Bold.ttf") format("truetype");
        font-weight: 800;
        font-style: normal;
      }
      @font-face {
        font-family: "MontzExtraBold";
        src: url("./font/MontserratZ-ExtraBold.ttf") format("truetype");
        font-weight: 900;
        font-style: normal;
      }
      @font-face {
        font-family: "MontzBlack";
        src: url("./font/MontserratZ-Black.ttf") format("truetype");
        font-weight: 900;
        font-style: normal;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: stretch;
        flex-direction: column;
        height: 100vh;
        width: 100%;
        font-family: "MontzExtraBold";
        background: lightgrey;
      }

      table.dataTable {
        border-collapse: collapse;
        width: 100%;
      }

      table.dataTable thead tr {
        background: crimson;
        color: white;
      }

      table.dataTable th,
      table.dataTable td {
        padding: 2px;
      }

      table.dataTable thead {
        display: none !important;
      }

      table.dataTable tbody th,
      table.dataTable tbody td {
        padding: 2px 10px !important;
      }

      .wrapper_all {
        width: 100%;
        margin: 0 auto;
      }

      .content-cote {
        font-size: 1.5vh;
        text-transform: uppercase;
        padding: 10px 0;
      }

      .content-cote > div {
        margin-bottom: 0.3em;
      }

      .content-cote p {
        padding: 5px;
        border-radius: 2px;
      }

      .content-cote .matches-cote {
        display: flex;
        justify-content: space-between;
        margin: 0 10% 0.3em;
      }

      .content-cote .matches-cote p {
        font-size: 1.4em;
        background: var(--red);
        width: 30%;
        text-align: center;

        color: #fff;
      }

      .content-cote .date-cote p {
        font-family: "MontzExtraBold";
        background: var(--gray);
        padding: 0;
        color: #fff;
      }

      .content-cote .number-cote p {
        font-family: "MontzBlack";
      }

      .content-cote .date-cote {
        text-align: center;
      }

      .content-cote .date-cote p {
        width: 50%;
        margin: auto;
        font-size: 1.3em;
        color: #fff;
      }

      .content-cote .number-cote {
        display: flex;
        justify-content: center;
        align-items: center;
        background: #fff;
        width: 75%;
        margin: 0 auto 0.4em;
      }

      .number-cote span {
        color: var(--gray);
        margin: 0 10px;
      }

      .number-cote p {
        color: var(--blue);
        font-size: 1.4em;
      }

      table.dataTable.row-border tbody th,
      table.dataTable.row-border tbody td,
      table.dataTable.display tbody th,
      table.dataTable.display tbody td {
        border: 0 !important;
      }
      table.dataTable tbody tr {
        cursor: pointer !important;
      }
      .dt-paging {
        text-align: center !important;
      }

      #tableJsBets_wrapper {
        width: 80%;
        margin: 0 auto;
      }

      #tableJsBets {
        width: 100% !important;
      }

      .coteMatch {
        width: 80%;
        max-width: 900px;
        min-width: 700px;
        margin: auto;
      }

      table.dataTable.stripe tbody tr.odd,
      table.dataTable.display tbody tr.odd {
        background: transparent;
      }

      table.dataTable.stripe tbody tr.even,
      table.dataTable.display tbody tr.even {
        background: transparent;
      }

      table.dataTable.no-footer {
        border: 0 !important;
      }

      .dataTables_wrapper .dataTables_paginate {
        text-align: center !important;
        width: 100%;
      }

      table.dataTable.display > tbody > tr:hover > * {
        background: var(--gray);
        transition: ease 0.3s;
      }
    </style>
  </head>
  <body>
    <table id="tableJsBets" class="display">
      <tbody></tbody>
    </table>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.7/js/dataTables.min.js"></script>
    <script>
      async function fetchOddsData() {
        try {
          const response = await fetch("https://casino-promo.netbet.ro/scripts/utils/event_feed_euro2024.php?lang=RO&provider_competition_id=1855");
          const data = await response.json();
          return data.items;
        } catch (error) {
          console.error("Error fetching data:", error);
          return [];
        }
      }

      function translateTeamName(teamName) {
        const translations = {
          Germany: "Germania",
          "Czech Republic": "Cehia",
          Hungary: "Ungaria",
          Switzerland: "Elveția",
          Spain: "Spania",
          Poland: "Polonia",
          Slovenia: "Slovenia",
          Denmark: "Danemarca",
          Netherlands: "Olanda",
          Albania: "Albania",
          Croatia: "Croația",
          Serbia: "Serbia",
          England: "Anglia",
          Slovakia: "Slovacia",
          Georgia: "Georgia",
          Portugal: "Portugalia",
          Italy: "Italia",
          Scotland: "Scoția",
          Ukraine: "Ucraina",
          France: "Franța",
          Belgium: "Belgia",
          Turkey: "Turcia",
          Austria: "Austria",
        };
        return translations[teamName] || teamName;
      }

      function formatOdds(odds) {
        return Number.isInteger(parseFloat(odds))
          ? `${odds}.00`
          : parseFloat(odds).toFixed(2);
      }

      function formatDate(dateString) {
        const [year, month, day] = dateString.split("-");
        return `${day}-${month}-${year}`;
      }

      async function fetchAndParseOddsData() {
        const rawData = await fetchOddsData();

        const parsedData = Object.values(rawData)
          .filter((item) => item.provider_competition_id === 1855)
          .map((item) => {
            if (!item.markets || !item.markets.match_result) {
              return null;
            }
            return {
              home_team: translateTeamName(item.home_team),
              away_team: translateTeamName(item.away_team),
              starts_at: formatDate(item.starts_at.split(" ")[0]),
              home_odds: formatOdds(item.markets.match_result[0].odds_decimal),
              draw_odds: formatOdds(item.markets.match_result[1].odds_decimal),
              away_odds: formatOdds(item.markets.match_result[2].odds_decimal),
              id: item.id.replace("1-", ""),
              name: item.name,
            };
          })
          .filter((item) => item !== null);

        return parsedData;
      }

      function initTableOdds(selector, parsedData) {
        dataTableOdds(selector, parsedData);
      }

      // Fetch and parse the data, then initialize the table
      fetchAndParseOddsData().then((parsedData) => {
        initTableOdds("#tableJsBets", parsedData);
      });

      function generateLink(name, id) {
        const parts = name.split(" vs ");
        const translatedParts = parts.map((team) => translateTeamName(team));
        const translatedName = translatedParts.join(" vs ");
        const formattedName = translatedName.toLowerCase().replace(/\s+/g, "-");
        console.log(formattedName, "fasfa");
        return `https://sport.netbet.ro/fotbal/european-championship/${formattedName}-${id}/`;
      }

      function dataTableOdds(selector, data) {
        return new DataTable(selector, {
          data: data,
          columns: [
            {
              title: "Echipe",
              data: null,
              render: function (data, type, row) {
                const [date] = row.starts_at.split(" ");
                return `
                  <div class="content-cote">
                    <div class="matches-cote">
                      <p>${row.home_team}</p> <p>1x2</p> <p>${row.away_team}</p>
                    </div>
                    <div class="date-cote"><p>${date}</p></div>
                    <div class="number-cote">
                      <p>${row.home_odds}<span>|</span></p>
                      <p>${row.draw_odds}<span>|</span></p>
                      <p>${row.away_odds}</p>
                    </div>
                  </div>
                `;
              },
            },
          ],
          paging: true,
          info: false,
          lengthChange: false,
          responsive: false,
          pageLength: window.innerWidth < 991 ? 4 : 5,
          searching: false,
          ordering: false,
          pagingType: "first_last_numbers",
          createdRow: function (row, data) {
            const link = generateLink(data.name, data.id);
            row.addEventListener("click", function () {
              let a = document.createElement("a");
              a.href = link;
              a.target = "_blank";
              a.rel = "noopener "; //  security // -- noreferrer !tracking
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
            });
          },
        });
      }
    </script>
  </body>
</html>
