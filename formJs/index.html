<!DOCTYPE html>
<html lang="ro">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Formular</title>
  </head>
  <style>
    .float-label-input {
      margin: 10px 0;
    }
    .success {
      color: green !important; /* Setăm culoarea textului la roșu pentru clasa "success" */
    }
  </style>
  <body>
    <div
      class="container bg-red-200 container-page flex lg:flex-row flex-col items-center mx-auto p-4 lg:space-x-6"
    >
      <div class="lg:max-w-[50%] flex items-center justify-center">
        <img
          src="./png/title_generic.png"
          alt="title"
          class="w-[90%] h-[90%] object-contain"
        />
      </div>

      <div
        class="container lg:max-w-[50%] flex flex-col bg-white p-5 rounded-md"
      >
        <div class="container-title text-center">
          <h1 class="py-3 text-4xl font-bold">Felicitări</h1>
          <h3 class="pb-3 text-md px-2">
            Vă rugăm completați formularul de mai jos pentru a intra în posesia
            premiilor
          </h3>
        </div>
        <form id="dataForm" class="w-full mx-auto w-full py-3">
          <div id="messageDiv" class="w-full text-center text-red-500"></div>
          <div
            class="container-name w-full md:grid md:grid-cols-3 md:space-x-2"
          >
            <div class="relative float-label-input">
              <label for="_name">Nume</label>
              <input id="_name" type="text" placeholder="" required />
            </div>
            <div class="relative float-label-input">
              <label for="_lastName">Prenume</label>
              <input id="_lastName" type="text" placeholder="" required />
            </div>
            <div class="float-label-input">
              <label for="_phone">Telefon</label>
              <input id="_phone" type="tel" placeholder="" required />
            </div>
          </div>
          <div
            class="container-info w-full md:grid md:grid-cols-2 md:space-x-2"
          >
            <div class="float-label-input">
              <label for="_city">Oraș</label>
              <input id="_city" type="text" placeholder="" required />
            </div>
            <div class="float-label-input">
              <label for="_street">Stradă</label>
              <input id="_street" type="text" placeholder="" required />
            </div>
          </div>
          <div class="container-info md:grid grid-cols-5 grid space-x-2">
            <div class="float-label-input">
              <label for="_house">Bloc</label>
              <input id="_house" type="text" placeholder="" required />
            </div>
            <div class="float-label-input">
              <label for="_houseNr">Număr</label>
              <input id="_houseNr" type="text" placeholder="" required />
            </div>
            <div class="float-label-input">
              <label for="_floor">Etaj</label>
              <input id="_floor" type="text" placeholder="" required />
            </div>
            <div class="float-label-input col-span-2">
              <label for="_postalCode">Cod Poștal</label>
              <input id="_postalCode" type="number" placeholder="" required />
            </div>
          </div>
        </form>
        <button
          type="button"
          id="submitBtn"
          class="bg-orange-500 text-white font-bold text-md p-3 rounded-md w-1/4"
        >
          Trimite
        </button>
      </div>
    </div>

    <script>
      const inputDiv = document.querySelectorAll("input");
      const labelDiv = document.querySelectorAll("label");
      inputDiv.forEach((input) => {
        input.classList.add(
          "w-full",
          "bg-white",
          "focus:outline-none",
          "focus:shadow-outline",
          "border",
          "border-gray-300",
          "py-3",
          "px-3",
          "block",
          "appearance-none",
          "leading-normal",
          "focus:border-blue-400",
          "rounded-lg"
        );
      });
      labelDiv.forEach((label) => {
        label.classList.add(
          "relative",
          "top-[-2px]",
          "left-[3px]",
          "focus:shadow-outline",
          "text-gray-400",
          "pointer-events-none",
          "transition",
          "duration-200",
          "ease-in-out",
          "bg-transparent",
          "text-gray-900",
          "rounded-t-lg"
        );
      });
    </script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDiOqUAHF9DX9x-VdRhaGPc2_Yfj305Jxc",
        authDomain: "netbet-ea33f.firebaseapp.com",
        databaseURL:
          "https://netbet-ea33f-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "netbet-ea33f",
        storageBucket: "netbet-ea33f.appspot.com",
        messagingSenderId: "184670151760",
        appId: "1:184670151760:web:08506858f2b8843fb19d55",
        measurementId: "G-7FX1PZEFQW",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const dataForm = document.getElementById("dataForm");
      const submitBtn = document.getElementById("submitBtn");
      const messageDiv = document.getElementById("messageDiv");
      const playerId = 3;

      function validateAndSetColor(inputElement) {
        const isValid = inputElement.value.trim() !== "";
        inputElement.style.borderColor = isValid ? "green" : "red";
        return isValid;
      }

      // Function to attach input event listeners to input fields
      function attachInputEventListeners(inputElements) {
        inputElements.forEach((inputElement) => {
          inputElement.addEventListener("input", () => {
            validateAndSetColor(inputElement);
          });
        });
      }

      const inputElements = [
        document.getElementById("_name"),
        document.getElementById("_lastName"),
        document.getElementById("_phone"),
        document.getElementById("_city"),
        document.getElementById("_street"),
        document.getElementById("_house"),
        document.getElementById("_houseNr"),
        document.getElementById("_floor"),
        document.getElementById("_postalCode"),
      ];

      // Attach input event listeners to all input fields
      attachInputEventListeners(inputElements);

      document
        .getElementById("submitBtn")
        .addEventListener("click", async (event) => {
          event.preventDefault();

          const areAllValid = inputElements.every((inputElement) =>
            validateAndSetColor(inputElement)
          );

          if (!areAllValid) {
            messageDiv.innerHTML = "Vă rugăm să completați toate câmpurile";
            return;
          }

          const data = {
            _playerId: playerId,
            destinatar_nume: inputElements[0].value,
            destinatar_prenume: inputElements[1].value,
            destinatar_telefon: inputElements[2].value,
            destinatar_oras: inputElements[3].value,
            destinatar_strada: inputElements[4].value,
            destinatar_bloc: inputElements[5].value,
            destinatar_nr: inputElements[6].value,
            destinatar_etaj: inputElements[7].value,
            destinatar_codpostal: inputElements[8].value,
          };

          try {
            const docRef = await addDoc(
              collection(db, "batalia_2023_premii"),
              data
            );
            messageDiv.innerHTML = `Datele au fost adăugate`;
            messageDiv.classList.add("success");
            setTimeout(() => {
              messageDiv.innerHTML = "";
              messageDiv.classList.remove("success");
            }, 1000);
            if (dataForm) {
              dataForm.reset();
              inputElements.forEach((inputElement) => {
                inputElement.style.borderColor = "";
              });
            }
          } catch (error) {
            messageDiv.innerHTML = `Error adding data: ${error}`;
            messageDiv.classList.remove("success");
          }
        });
    </script>
  </body>
</html>
