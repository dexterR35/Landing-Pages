<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"
      integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <title>Document</title>
  </head>
  <body>
    <div class="codd " ></div>
    <div class="coddddd  error-message" ></div>
    <div class="input">
      <!-- <input type="text" placeholder="test" class="input_n4" id="grabcode" />
      <input type="text" placeholder="email" class="input_n0" id="emailcode" /> -->
    </div>

    <!-- <input type="number" placeholder="nt" class="input_n3" id="emailcode" /> -->
    <!-- <button id="btn-sendData">click</button> -->
    <form>
      <input type="email" class="input_n0">
      <a href="https://casino.netbet.ro/"> <button type="submit" id="btn-sendData">Submit</button></a>
    </form>
    <!-- <form>
      <input type="text" id="email" />
      <input type="text" id="input" />
      <button type="submit">Submit</button>
    </form> -->

    <!-- <script>
      const form = document.querySelector("form");
      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const email = document.getElementById("email").value;
        const input = document.getElementById("input").value;
        const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if (!emailRegex.test(email) || input.length < 2) {
          alert("Please enter a valid email address.");
       
        } else {
          form.submit();
        }
      });
    </script> -->
    <script>
      // const inputNumber = document.querySelector(".input_n3");
      //     inputNumber.addEventListener("input", function (event) {
      //       if (this.value < "7") {
      //         this.value = "";
      //       }

      //     });
      // const inputNumber = document.querySelector(".input_n3");
      // inputNumber.addEventListener("input", function (event) {
      //   if (this.value.length === 1 && this.value !== "7") {
      //     this.value = "";
      //   } else if (this.value.length > 1 && this.value[0] !== "7") {
      //     this.value = "" + this.value.substring(1);
      //   }
      // });

      let largeCode = "";
      function retriveData() {
        let request = new XMLHttpRequest();
        request.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            let codeText = this.responseText;
            let codetest  = document.querySelector(".codd");
            codetest.innerHTML += codeText;
            console.log(codeText, "cod recived");
            if (codeText.match(/A250/gi) || codeText.match(/A350/gi)) {
              largeCode = codeText;
            } else if (codeText.match(/B250/gi) || codeText.match(/B350/gi)) {
              console.log(codeText, "B>");
              largeCode = codeText;
            } else if (codeText.match(/C250/gi) || codeText.match(/C350/gi)) {
              console.log(codeText, "C>");
              largeCode = codeText;
            } else if (codeText.match(/D250/gi) || codeText.match(/D350/gi)) {
              console.log(codeText, "D>");
              largeCode = codeText;
            } else if (codeText.match(/E250/gi) || codeText.match(/E350/gi)) {
              largeCode = codeText;
              console.log(codeText, "e>");
            } else if (codeText.match(/F250/gi) || codeText.match(/F350/gi)) {
              largeCode = codeText;
              console.log(codeText, "f>");
            } else {
              console.log("Error no mached");
            }
          }
        };
        request.open(
          "GET",
          "https://casino-promo.netbet.ro/scripts/api/space/getcode.php"
        );
        request.send();
      }
      // const form = document.querySelector("form");
      //       const emailInput = document.querySelector(".input_n0");
      //       form.addEventListener("submit", function(event) {
      //         event.preventDefault();
      //         let email = emailInput.value;
      //         let xhr = new XMLHttpRequest();
      //         xhr.open("POST", "https://casino-promo.netbet.ro/scripts/api/space/setcode.php");
      //         xhr.setRequestHeader("Accept", "application/json");
      //         xhr.setRequestHeader("Content-Type", "application/json");
      //         xhr.onreadystatechange = function () {
      //           if (xhr.readyState === 4) {
      //             console.log(xhr.status);
      //             console.log(xhr.responseText);
      //           }
      //         };
      //         let details_send = `{"email": "`+email+`","code": "`+largeCode+`"}`;
      //         console.log(details_send,"test");
      //         xhr.send(details_send);
      //       });



//       const form = document.querySelector("form");
// const emailInput = document.querySelector(".input_n0");
// form.addEventListener("submit", function(event) {
//   event.preventDefault();
//   let email = emailInput.value;
//   let xhr = new XMLHttpRequest();
//   xhr.open("POST", "https://casino-promo.netbet.ro/scripts/api/space/setcode.php");
//   xhr.setRequestHeader("Accept", "application/json");
//   xhr.setRequestHeader("Content-Type", "application/json");
  
//   let promise = new Promise(function(resolve, reject) {
//     xhr.onreadystatechange = function () {
//       if (xhr.readyState === 4 && xhr.status === 200) {
//         resolve(xhr.responseText);
//       } else if (xhr.readyState === 4) {
//         reject(xhr.status);
//       }
//     };
//   });
  
//   let details_send = `{"email": "`+email+`","code": "`+largeCode+`"}`;
//   console.log(details_send,"test");
//   xhr.send(details_send);
  
//   promise.then(function(response) {
//     console.log("Success:", response);
//     window.location.href = "https://casino.netbet.ro/";
//   }).catch(function(error) {
//     console.error("Error:", error);
//   });
// });

const form = document.querySelector("form");
const emailInput = document.querySelector(".input_n0");
const errorMessage = document.querySelector(".error-message");

form.addEventListener("submit", function(event) {
  event.preventDefault();
  let email = emailInput.value;

  let xhr = new XMLHttpRequest();
  xhr.open("POST", "https://casino-promo.netbet.ro/scripts/api/space/check_email.php");
  xhr.setRequestHeader("Accept", "application/json");
  xhr.setRequestHeader("Content-Type", "application/json");
  
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        let response = JSON.parse(xhr.responseText);
        if (response.is_used) {
          errorMessage.textContent = "This email is already in use";
        } else {
          let xhr2 = new XMLHttpRequest();
          xhr2.open("POST", "https://casino-promo.netbet.ro/scripts/api/space/setcode.php");
          xhr2.setRequestHeader("Accept", "application/json");
          xhr2.setRequestHeader("Content-Type", "application/json");
          xhr2.onreadystatechange = function () {
            if (xhr2.readyState === 4) {
              console.log(xhr2.status);
              console.log(xhr2.responseText);
              window.location.href = "https://www.example.com";
            }
          };
          let details_send = `{"email": "`+email+`","code": "`+largeCode+`"}`;
          console.log(details_send,"test");
          xhr2.send(details_send);
        }
      } else {
        console.error(xhr.statusText);
      }
    }
  };

  let checkEmail = `{"email": "`+email+`"}`;
  xhr.send(checkEmail);
});


      retriveData();

      // let emailInput = document.getElementById("emailcode");
      // let email = emailInput.value;

      // let codes_grab = document.getElementsByClassName("input_n4").value;

      // const button_clickData = document.getElementById("btn-sendData");
      // $("#btn-sendData").one("click", function () {
      //   var emailInput = document.querySelector(".input_n0");
      //   var email = emailInput.value;

      //   let xhr = new XMLHttpRequest();
      //   xhr.open(
      //     "POST",
      //     "https://casino-promo.netbet.ro/scripts/api/space/setcode.php"
      //   );
      //   xhr.setRequestHeader("Accept", "application/json");
      //   xhr.setRequestHeader("Content-Type", "application/json");

      //   xhr.onreadystatechange = function () {
      //     if (xhr.readyState === 4) {
      //       console.log(xhr.status);
      //       console.log(xhr.responseText);
      //     }
      //   };

      //   let details_send =
      //     `{"email": "` + email + `","code": "` + largeCode + `"}`;
      //   console.log(details_send, "test");

      //   xhr.send(details_send);
      // });
      // console.log(codes_grab, "= code sent");

      // let emailInput = document.getElementById("emailcode");
      // let email = emailInput.value;

      // let codes_grab = document.getElementsByClassName("input_n4").value;

      // const button_clickData = document.getElementById("btn-sendData");
      // $("#btn-sendData").one("click", function(){
      //   var emailInput = document.querySelector(".input_n0");
      //   var email = emailInput.value;

      //   let details_send = `{"email": "`+email+`","code": "`+largeCode+`"}`;
      //   console.log(details_send,"test")

      //   postData('https://casino-promo.netbet.ro/scripts/api/space/setcode.php', details_send)
      //     .then(function (data) {
      //       console.log(data);
      //     })
      //     .catch(function (error) {
      //       console.error(error);
      //     });
      // });

      // function postData(url, data) {
      //   return new Promise(function (resolve, reject) {
      //     let xhr = new XMLHttpRequest();
      //     xhr.open("POST", url);
      //     xhr.setRequestHeader("Accept", "application/json");
      //     xhr.setRequestHeader("Content-Type", "application/json");

      //     xhr.onreadystatechange = function () {
      //       if (xhr.readyState === 4 && xhr.status === 200) {
      //         resolve(xhr.responseText);
      //       } else if (xhr.readyState === 4) {
      //         reject(xhr.status);
      //       }
      //     };

      //     xhr.send(data);
      //   });
      // }

      // console.log(codes_grab, "= code sent");


/*const form = document.querySelector("form");
const emailInput = document.querySelector(".input_email");
const numberInput = document.querySelector(".input_number");

form.addEventListener("submit", function(event) {
  event.preventDefault();
  
  const email = emailInput.value;
  const number = numberInput.value;
  
  validateInputs(email, number)
    .then(function(response) {
      if (response === "Success") {
        window.location.href = "https://www.example.com";
      }
    })
    .catch(function(error) {
      alert(error);
    });
});

function validateInputs(email, number) {
  return new Promise(function(resolve, reject) {
    const emailRegex = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    const numberRegex = /^\d{10}$/;
    
    if (!emailRegex.test(email)) {
      reject("Invalid email address");
    } else if (!numberRegex.test(number)) {
      reject("Invalid number");
    } else {
      resolve("Success");
    }
  });
}
In this example, the form submit event is intercepted and the email and number inputs are retrieved. The validateInputs function is then called, which returns a Promise that either resolves with "Success" if both inputs are valid or rejects with an error message if either the email or number is invalid. The then and catch methods of the Promise handle the success and error cases respectively*/

    </script>
          <script>
         
          </script>
  </body>
</html>
