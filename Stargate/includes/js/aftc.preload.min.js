function log(e){console&&console.log(e)}var AFTC=AFTC||{};AFTC.Preloader=function(){if(this.params={que:[],jsQue:[],svgs:[],cache:!0,batch:[],batchSize:4,filesInBatch:0,types:[],attachImagesToDom:!1,domElementToAttachImagesTo:"",attachScriptsToDom:!0,attachStyleSheetsToDom:!0,noOfJSFiles:0,noOfJSFilePreloaded:0,noOfFilesToPreload:0,noOfFilesLoaded:0,noOfFilesFailed:0,percentLoaded:0,error:!1,onComplete:null,onProgress:null,onError:null,xhrAvailable:!1},AFTC.Preloader.FileVo=function(){this.id=null,this.url="",this.urlCacheString="",this.ext="",this.processed=!1,this.done=!1,this.cache=!0,this.loading=!1,this.xhr=null,this.xhrLoading=!1,this.xhrProgress=0,this.xhrSuccess=!1,this.xhrReadyState="",this.xhrStatus=0,this.xhrStatusText="",this.xhrProcessed=!1,this.isImage=!1,this.imgWidth=200,this.imgHeight=150,this.imgClass=null,this.jsLoading=!1,this.jsSuccess=!1,this.jsProcessed=!1,this.batchIndex=-1},arguments[0]&&"object"==typeof arguments[0])for(var e in arguments[0])this.params.hasOwnProperty(e)?this.params[e]=arguments[0][e]:console.error("AFTC.Preloader: Usage Error - Unknown paramater ["+e+"]");this.init=function(){this.params.noOfFilesToPreload=this.params.que.length+this.params.jsQue.length,this.params.noOfJSFilePreloaded=0,this.params.noOfJSFiles=this.params.jsQue.length,this.params.noOfFilesLoaded=0,this.params.noOfFilesFailed=0,this.params.percentLoaded=0;for(var e=0;e<this.params.batchSize;e++)this.params.batch[e]=null;(XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"))&&(this.params.xhrAvailable=!0,""),this.getBatchFilesToLoad()}},AFTC.Preloader.prototype.xhrLoad=function(e){function t(e){e.target.readyState;var t=e.target._batchIndex,r=e.target._me.params.batch[t];r.xhrReadyState=e.target.readyState,r.xhrStatus=e.target.status,4===r.xhrReadyState&&(200===r.xhrStatus?r.xhrSuccess=!0:r.xhrSuccess=!1,r.xhrStatusText=e.target.statusText)}var r=window.XMLHttpRequest.prototype.open,a=window.XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(e,t,a,s,o,i,n){return this._url=t,this._me=s,this._batchIndex=o,r.apply(this,arguments)},XMLHttpRequest.prototype.send=function(e){return this.onreadystatechange&&(this._onreadystatechange=this.onreadystatechange),this.onreadystatechange=t,a.apply(this,arguments)},XMLHttpRequest?e.xhr=new XMLHttpRequest:e.xhr=new ActiveXObject("Microsoft.XMLHTTP"),e.xhr.addEventListener("progress",this.xhrProgressHandler),e.xhr.addEventListener("load",this.xhrLoadHandler),e.xhr.addEventListener("error",this.xhrErrorHandler),e.xhr.addEventListener("abort",this.xhrUserAbortHandler),e.xhr.addEventListener("loadend",this.xhrLoadEndHandler),e.xhrLoading=!0;var s=e.url;""!=e.urlCacheString&&(s+=e.urlCacheString),e.xhr.open("GET",s,!0,this,e.batchIndex),e.xhr.send()},AFTC.Preloader.prototype.xhrProgressHandler=function(e){var t=0;e.lengthComputable?(t=100/e.total*e.loaded,t=parseFloat(t.toFixed(2))):t=0;var r=e.target._batchIndex,a=e.target._me,s=a.params.batch[r];s.xhrProgress=t,a.onProgress(s)},AFTC.Preloader.prototype.xhrLoadHandler=function(e){var t=e.target._batchIndex,r=e.target._me.params.batch[t];r.xhrLoading=!1,r.xhrComplete=!0,r.xhr=null,delete r.xhr},AFTC.Preloader.prototype.xhrErrorHandler=function(e){},AFTC.Preloader.prototype.xhrUserAbortHandler=function(e){},AFTC.Preloader.prototype.xhrLoadEndHandler=function(e){var t=e.target._batchIndex,r=e.target._me,a=r.params.batch[t];a.xhrProcessed=!0,a.xhrLoading=!1,a.isImage?("svg"==a.ext&&r.params.svgs.push({id:a.id,svg:e.target.responseText,url:a.url}),r.jsLoadImage(a)):"js"==a.ext&&r.params.attachScriptsToDom?r.jsLoadScript(a):"css"==a.ext&&r.params.attachStyleSheetsToDom?r.jsLoadStyleSheet(a):(a.done=!0,r.params.noOfFilesFailed++,r.removeFileFromBatch(a))},AFTC.Preloader.prototype.add=function(e){var t=new AFTC.Preloader.FileVo;if(arguments[0]&&"object"==typeof arguments[0])for(var r in arguments[0])t.hasOwnProperty(r)?t[r]=arguments[0][r]:console.error("AFTC.Preloader.prototype.add(): ERROR: Unknown paramater: ["+r+"]");return null!=t.url||""!=t.url?(t.ext=t.url.split(".").pop(),this.params.cache&&t.cache||(t.urlCacheString="?c="+Math.round(9999999999*Math.random())),"png"!=t.ext&&"jpg"!=t.ext&&"jpeg"!=t.ext&&"png"!=t.ext&&"gif"!=t.ext&&"bmp"!=t.ext&&"svg"!=t.ext||(t.isImage=!0),"js"==t.ext&&this.params.noOfJSFiles++,this.params.que.push(t)):console.error("AFTC.Preloader.prototype.add(): ERROR: Function argument object.url missing!"),this},AFTC.Preloader.prototype.start=function(){this.init()},AFTC.Preloader.prototype.loadNow=function(e){},AFTC.Preloader.prototype.getSVGById=function(e){for(var t=0;t<this.params.svgs.length;t++){var r=this.params.svgs[t];if(r.id==e)return r.svg}return null},AFTC.Preloader.prototype.getBatchFilesToLoad=function(){if(this.params.filesInBatch>=this.params.batchSize)return!1;for(var e=this,t=!1,r=0;r<this.params.que.length&&!(this.params.filesInBatch>=this.params.batchSize);r++)if(!(o=this.params.que[r]).loading&&!o.processed){t=!0;var a=function(){for(var t=0;t<e.params.batchSize;t++)if(null==e.params.batch[t])return t;return-1}();if(-1==a)break;this.params.batch[a]=o,!0,o.processed=!0,o.batchIndex=a,this.params.filesInBatch++}if(!t){for(var s=!0,r=0;r<this.params.que.length;r++){var o=this.params.que[r];o.done||(s=!1)}return s&&this.params.onComplete&&this.params.onComplete(),!1}this.processBatchQue()},AFTC.Preloader.prototype.processBatchQue=function(){for(var e=0;e<this.params.batch.length;e++)if(null!=this.params.batch[e]){var t=this.params.batch[e];t.loading||(t.loading=!0,this.params.xhrAvailable?this.xhrLoad(t):t.isImage?this.jsLoadImage(t):"js"==t.ext?this.jsLoadScript(t):"css"==t.ext&&this.jsLoadStyleSheet(t))}},AFTC.Preloader.prototype.removeFileFromBatch=function(e){this.onProgress(e),this.params.batch[e.batchIndex]=null,this.params.filesInBatch--,this.getBatchFilesToLoad()},AFTC.Preloader.prototype.jsLoadImage=function(e){e.jsLoading=!0;var t=this,r=document.createElement("img");null!=e.id&&""!=e.id&&(r.id=e.id),r.width=e.imgWidth,r.height=e.imgHeight,r.className="img-test",r.onload=function(a){if(e.jsLoading=!1,e.jsSuccess=!0,e.jsProcessed=!0,e.done=!0,t.params.noOfFilesLoaded++,t.params.attachImagesToDom){var s=document.getElementById(t.params.domElementToAttachImagesTo);s&&s.appendChild(r)}t.removeFileFromBatch(e)},r.onerror=function(r){e.jsLoading=!1,e.jsSuccess=!0,e.jsProcessed=!0,e.done=!0,t.params.noOfFilesFailed++,t.removeFileFromBatch(e)};var a=e.url;""!=e.urlCacheString&&(a+=e.urlCacheString),r.src=a},AFTC.Preloader.prototype.jsLoadStyleSheet=function(e){e.processed=!0;var t=this,r=document.getElementsByTagName("head")[0],a=document.createElement("link");null!=e.id&&""!=e.id&&(a.id=e.id),a.rel="stylesheet",a.type="text/css",a.media="all";var s=e.url;""!=e.urlCacheString&&(s+=e.urlCacheString),a.href=s,a.onload=function(){e.jsLoading=!1,e.jsSuccess=!0,e.jsProcessed=!0,e.done=!0,t.params.noOfFilesLoaded++,t.removeFileFromBatch(e)},a.onerror=function(){e.jsLoading=!1,e.jsSuccess=!0,e.jsProcessed=!0,e.done=!0,t.params.noOfFilesFailed++,t.removeFileFromBatch(e)},r.appendChild(a)},AFTC.Preloader.prototype.jsLoadScript=function(e){e.processed=!0;var t=this,r=document.createElement("script");null!=e.id&&""!=e.id&&(r.id=e.id),r.onload=function(){e.jsLoading=!1,e.jsSuccess=!0,e.jsProcessed=!0,e.done=!0,t.params.noOfFilesLoaded++,t.removeFileFromBatch(e)},r.onerror=function(){e.jsLoading=!1,e.jsSuccess=!0,e.jsProcessed=!0,e.done=!0,t.params.noOfFilesFailed++,t.removeFileFromBatch(e)};var a=e.url;""!=e.urlCacheString&&(a+=e.urlCacheString),r.src=a,document.head.appendChild(r)},AFTC.Preloader.prototype.onProgress=function(e){var t=100/this.params.noOfFilesToPreload;this.params.percentLoaded=t*(this.params.noOfFilesLoaded+this.params.noOfFilesFailed),this.params.percentLoaded=parseFloat(this.params.percentLoaded.toFixed(2)),this.params.onProgress&&this.params.onProgress({percentLoaded:this.params.percentLoaded,noOfFilesToPreload:this.params.noOfFilesToPreload,noOfFilesLoaded:this.params.noOfFilesLoaded,noOfFilesFailed:this.params.noOfFilesFailed,url:e.url,urlCacheString:e.urlCacheString,ext:e.ext,xhrProgress:e.xhrProgress,xhrReadyState:e.xhrReadyState,xhrSuccess:e.xhrSuccess,jsPreloading:e.jsLoading,jsPreloadSuccess:e.jsSuccess})};