<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: sans-serif;
        color: white;
        font-weight: bold;
      }
      button {
        padding: 0.5em 1em;
        background-color: #c64923;
        color: white;
        text-transform: uppercase;
        font-weight: bold;
        border: none;
        border-radius: 3px;
        outline: none;
        margin-top: 10px;
        cursor: pointer;
        width: 200px;
        height: 3em;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        height: 90vh;
        width: 100%;
        background-color: darkslateblue;
      }
      input[type="text"] {
        padding: 0.7em;
        border: none;
        outline: none;
        background: lightgrey;
        color: black;

      }
      form {
        display: flex;
        flex-direction: column;
      
      }
      #content {
        font-size: 1.2em;
        margin: 20px;
      }
    </style>
  </head>

  <body>
    <div id="content"></div>
    <form id="registerForm" style="display: none">
      <input type="text" id="usernameInput" placeholder="Enter your username" />
      <button type="submit">Register / Login</button>
    </form>

    <button id="joinBattle" style="display: none">check / join</button>
    <button id="voteButton" style="display: none">Vote</button>
    <button id="clearDataButton" style="display: none">clearData</button>
    <script src="./cookieAsync.js"></script>

    <!-- <script>
      $(document).ready(function () {
        // Function to get the value of a cookie
        function getCookie(nameCookie) {
          let value = "; " + document.cookie;
          let parts = value.split("; " + nameCookie + "=");
          if (parts.length == 2) return parts.pop().split(";").shift();
          return null;
        }

        // Function to check if the user is authenticated
        function isAuthenticated() {
          // Check if the user is authenticated using cookies
          const username = getCookie("username");
          return username && username.trim() !== "";
        }

        // Function to check if the user has voted
        function hasVoted() {
          // Check if the user has voted using cookies
          const votedCookie = getCookie("voted");
          return votedCookie === "true";
        }

        // Function to check if the user has registered
        function hasRegistered() {
          // Check if the user has registered using cookies
          const registeredCookie = getCookie("registered");
          return registeredCookie === "true";
        }

        // Function to check if the user has joined the battle
        function hasJoinedBattle() {
          // Check if the user has joined the battle using cookies
          const joinedBattleCookie = getCookie("joined_battle");
          return joinedBattleCookie === "true";
        }

        // Get the username cookie value
        let cookieValue = getCookie("username");

        if (isAuthenticated()) {
          // User is logged in
          const username = cookieValue;

          // Check if the user has registered
          if (!hasRegistered()) {
            // User has not registered
            // Handle registration and update cookies/local storage
            $("#registerForm").show();
            console.log("User is not registered. Show register form.");

            // Handle the registration form submission
            $("#registerForm").submit(function (event) {
              event.preventDefault(); // Prevent the form from submitting

              // Get the username from the input field
              let username = $("#usernameInput").val();

              // Set the username in both cookie and local storage
              document.cookie = `username=${username}; expires=Thu, 18 Dec 2023 14:08:00 UTC; path=/`;
              localStorage.setItem("username", username);

              // Set the user as registered in both cookie and local storage
              document.cookie =
                "registered=true; expires=Thu, 18 Dec 2023 14:08:00 UTC; path=/";
              localStorage.setItem("registered", "true");

              // Set that the user has not joined the battle in both cookies and local storage
              document.cookie =
                "joined_battle=false; expires=Thu, 18 Dec 2023 14:08:00 UTC; path=/";
              localStorage.setItem("joined_battle", "false");

              // Set the "voted" flag to false in both cookies and local storage
              document.cookie =
                "voted=false; expires=Thu, 18 Dec 2023 14:08:00 UTC; path=/";
              localStorage.setItem("voted", "false");

              // Reload the page to apply the login logic
              location.reload();
            });
          } else {
            // User has registered
            // Check if the user has joined the battle
            if (!hasJoinedBattle()) {
              // User is not in battle
              // Show the "Participa now" button
              $("#joinBattle").show();
              $("#content").text("User is registered but is not in battle.");
              console.log("User is not in battle. Show Participa now button.");

              if (hasVoted()) {
                // User has already voted, hide the "Participa now" button
                $("#joinBattle").hide();
                $("#content").text("You have already voted.");
                console.log(
                  "You have already voted. Hide Participa now button."
                );
              } else {
                // User has not voted
                // Handle Participa now button click
                $("#joinBattle").click(function () {
                  // Set that the user has joined the battle in both cookies and local storage
                  document.cookie =
                    "joined_battle=true; expires=Thu, 18 Dec 2023 14:08:00 UTC; path=/";
                  localStorage.setItem("joined_battle", "true");

                  // Hide the "Participa now" button
                  $("#joinBattle").hide();

                  if (hasVoted()) {
                    // User has voted, show congratulatory message
                    $("#content").text(
                      "Congratulations! You have registered, joinBattle in the battle, and voted."
                    );
                    console.log(
                      "Congratulations! You have registered, joinBattle in the battle, and voted."
                    );
                  } else {
                    // User has not voted, show the "Vote" button
                    $("#voteButton").show();
                    $("#content").text(
                      "User joined the battle but has not voted. Click 'Vote' to joinBattle."
                    );
                    console.log("User has not voted. Show Vote button.");

                    // Handle Vote button click
                    $("#voteButton").click(function () {
                      // Set the "voted" flag in both cookies and local storage to track that the user has voted
                      document.cookie =
                        "voted=true; expires=Thu, 18 Dec 2023 14:08:00 UTC; path=/";
                      localStorage.setItem("voted", "true");

                      // Hide the "Vote" button
                      $("#voteButton").hide();

                      // Check if the user has registered, joinBattle, and voted
                      if (hasRegistered() && hasJoinedBattle() && hasVoted()) {
                        // Display the congratulatory message
                        $("#content").text(
                          "Congratulations! You have registered, joinBattle in the battle, and voted."
                        );
                        console.log(
                          "Congratulations! You have registered, joinBattle in the battle, and voted."
                        );
                      } else {
                        $("#content").text(
                          "not good"
                        );
                      }
                    });
                  }
                });
              }
            } else {
              // User is in battle
              // Show a message indicating that the user is in battle

              if (!hasVoted()) {
                // User has not voted yet, show the "Vote" button
                $("#voteButton").show();
                console.log(
                  "User is in battle but has not voted. Show Vote button."
                );
                $("#content").text("User is in battle but has not voted.");
                // Handle Vote button click
                $("#voteButton").click(function () {
                  // Set the "voted" flag in both cookies and local storage to track that the user has voted
                  document.cookie =
                    "voted=true; expires=Thu, 18 Dec 2023 14:08:00 UTC; path=/";
                  localStorage.setItem("voted", "true");

                  // Hide the "Vote" button
                  $("#voteButton").hide();

                  // Check if the user has registered, joinBattle, and voted
                  if (hasRegistered() && hasJoinedBattle() && hasVoted()) {
                    // Display the congratulatory message
                    $("#content").text(
                      "Congratulations! You have registered, joinBattle in the battle, and voted."
                    );
                    console.log(
                      "Congratulations! You have registered, joinBattle in the battle, and voted."
                    );
                  }
                });
              } else if (hasRegistered() && hasJoinedBattle() && hasVoted()) {
                // Display the congratulatory message
                $("#content").text(
                  "Congratulations! You have registered, joinBattle in the battle, and voted."
                );
                console.log(
                  "Congratulations! You have registered, joinBattle in the battle, and voted."
                );
              } else {
                // User has already voted
                console.log("else");
              }
            }
          }
        } else {
          // User is not logged in
          // Show the register form with an input field
          $("#registerForm").show();
          console.log("User is not logged in. Show register form.");

          // Handle the registration form submission
          $("#registerForm").submit(function (event) {
            event.preventDefault(); // Prevent the form from submitting

            // Get the username from the input field
            let username = $("#usernameInput").val();

            // Set the username in both cookie and local storage
            document.cookie = `username=${username}; expires=Thu, 18 Dec 2023 14:08:00 UTC; path=/`;
            localStorage.setItem("username", username);

            // Set the user as registered in both cookie and local storage
            document.cookie =
              "registered=true; expires=Thu, 18 Dec 2023 14:08:00 UTC; path=/";
            localStorage.setItem("registered", "true");

            // Set that the user has not joined the battle in both cookies and local storage
            document.cookie =
              "joined_battle=false; expires=Thu, 18 Dec 2023 14:08:00 UTC; path=/";
            localStorage.setItem("joined_battle", "false");

            // Set the "voted" flag to false in both cookies and local storage
            document.cookie =
              "voted=false; expires=Thu, 18 Dec 2023 14:08:00 UTC; path=/";
            localStorage.setItem("voted", "false");

            // Reload the page to apply the login logic
            location.reload();
          });
        }
      });

    



//for backend
      /*
      $(document).ready(async function () {
  // Function to get the value of a cookie
  function getCookie(nameCookie) {
    let value = "; " + document.cookie;
    let parts = value.split("; " + nameCookie + "=");
    if (parts.length === 2) return parts.pop().split(";").shift();
    return null;
  }

  // Function to check if the user is authenticated
  async function isAuthenticated() {
    // Check if the user is authenticated using cookies or server
    const username = getCookie("username");
    if (username && username.trim() !== "") {
      // Check with the server if the user is authenticated
      const isAuthenticated = await checkAuthentication(username);
      return isAuthenticated;
    }
    return false;
  }

  // Replace this function with your server authentication logic
  async function checkAuthentication(username) {
    // Replace with a server request to check if the user is authenticated
    // Return true if authenticated, false otherwise
    return true;
  }

  // Function to check if the user has voted
  async function hasVoted() {
    // Check if the user has voted using cookies or server
    const votedCookie = getCookie("voted");
    if (votedCookie === "true") {
      // Check with the server if the user has voted
      const hasVoted = await checkHasVoted();
      return hasVoted;
    }
    return false;
  }

  // Replace this function with your server check for voting
  async function checkHasVoted() {
    // Replace with a server request to check if the user has voted
    // Return true if voted, false otherwise
    return true;
  }

  // Function to check if the user has registered
  async function hasRegistered() {
    // Check if the user has registered using cookies or server
    const registeredCookie = getCookie("registered");
    if (registeredCookie === "true") {
      // Check with the server if the user is registered
      const isRegistered = await checkRegistrationStatus();
      return isRegistered;
    }
    return false;
  }

  // Replace this function with your server registration check
  async function checkRegistrationStatus() {
    // Replace with a server request to check if the user is registered
    // Return true if registered, false otherwise
    return true;
  }

  // Function to check if the user has joined the battle
  async function hasJoinedBattle() {
    // Check if the user has joined the battle using cookies or server
    const joinedBattleCookie = getCookie("joined_battle");
    if (joinedBattleCookie === "true") {
      // Check with the server if the user has joined the battle
      const hasJoined = await checkJoinStatus();
      return hasJoined;
    }
    return false;
  }

  // Replace this function with your server join status check
  async function checkJoinStatus() {
    // Replace with a server request to check if the user has joined the battle
    // Return true if joined, false otherwise
    return true;
  }

  // Get the username cookie value
  let cookieValue = getCookie("username");

  if (await isAuthenticated()) {
    // User is logged in
    const username = cookieValue;

    if (!(await hasRegistered())) {
      // User has not registered
      // Handle registration and update cookies/server
      $("#registerForm").show();
      console.log("User is not registered. Show register form.");

      // Handle the registration form submission
      $("#registerForm").submit(async function (event) {
        event.preventDefault(); // Prevent the form from submitting

        // Get the username from the input field
        let username = $("#usernameInput").val();

        // Set the username on the server
        await setServerUsername(username);

        // Set the user as registered on the server
        await setServerRegisteredStatus();

        // Set that the user has not joined the battle on the server
        await setServerJoinStatus(false);

        // Set the "voted" flag to false on the server
        await setServerVotedStatus(false);

        // Reload the page to apply the login logic
        location.reload();
      });
    } else {
      // User has registered
      // Check if the user has joined the battle
      if (!(await hasJoinedBattle())) {
        // User is not in battle
        // Show the "Participa now" button
        $("#joinBattle").show();
        $("#content").text("User is registered but is not in battle.");
        console.log("User is not in battle. Show Participa now button.");

        if (!(await hasVoted())) {
          // User has not voted
          // Handle Participa now button click
          $("#joinBattle").click(async function () {
            // Set that the user has joined the battle on the server
            await setServerJoinStatus(true);

            // Hide the "Participa now" button
            $("#joinBattle").hide();

            if (!(await hasVoted())) {
              // User has not voted, show the "Vote" button
              $("#voteButton").show();
              $("#content").text("User joined the battle but has not voted. Click 'Vote' to joinBattle.");
              console.log("User has not voted. Show Vote button.");

              // Handle Vote button click
              $("#voteButton").click(async function () {
                // Set the "voted" flag on the server to track that the user has voted
                await setServerVotedStatus(true);

                // Hide the "Vote" button
                $("#voteButton").hide();

                if (
                  (await hasRegistered()) &&
                  (await hasJoinedBattle()) &&
                  (await hasVoted())
                ) {
                  // Display the congratulatory message
                  $("#content").text(
                    "Congratulations! You have registered, joinBattle in the battle, and voted."
                  );
                  console.log(
                    "Congratulations! You have registered, joinBattle in the battle, and voted."
                  );
                } else {
                  $("#content").text("not good");
                }
              });
            }
          });
        }
      } else {
        // User is in battle
        // Show a message indicating that the user is in battle

        if (!(await hasVoted())) {
          // User has not voted yet, show the "Vote" button
          $("#voteButton").show();
          console.log("User is in battle but has not voted. Show Vote button.");
          $("#content").text("User is in battle but has not voted.");

          // Handle Vote button click
          $("#voteButton").click(async function () {
            // Set the "voted" flag on the server to track that the user has voted
            await setServerVotedStatus(true);

            // Hide the "Vote" button
            $("#voteButton").hide();

            if (
              (await hasRegistered()) &&
              (await hasJoinedBattle()) &&
              (await hasVoted())
            ) {
              // Display the congratulatory message
              $("#content").text(
                "Congratulations! You have registered, joinBattle in the battle, and voted."
              );
              console.log(
                "Congratulations! You have registered, joinBattle in the battle, and voted."
              );
            }
          });
        } else if (
          (await hasRegistered()) &&
          (await hasJoinedBattle()) &&
          (await hasVoted())
        ) {
          // Display the congratulatory message
          $("#content").text(
            "Congratulations! You have registered, joinBattle in the battle, and voted."
          );
          console.log(
            "Congratulations! You have registered, joinBattle in the battle, and voted."
          );
        } else {
          // User has already voted
          console.log("else");
        }
      }
    }
  } else {
    // User is not logged in
    // Show the register form with an input field
    $("#registerForm").show();
    console.log("User is not logged in. Show register form.");

    // Handle the registration form submission
    $("#registerForm").submit(async function (event) {
      event.preventDefault(); // Prevent the form from submitting

      // Get the username from the input field
      let username = $("#usernameInput").val();

      // Set the username on the server
      await setServerUsername(username);

      // Set the user as registered on the server
      await setServerRegisteredStatus();

      // Set that the user has not joined the battle on the server
      await setServerJoinStatus(false);

      // Set the "voted" flag to false on the server
      await setServerVotedStatus(false);

      // Reload the page to apply the login logic
      location.reload();
    });
  }
});

// Replace these functions with your server-side functions
async function setServerUsername(username) {
  // Replace with a server request to set the username
}

async function setServerRegisteredStatus() {
  // Replace with a server request to set the registered status
}

async function setServerJoinStatus(status) {
  // Replace with a server request to set the join status
}

async function setServerVotedStatus(status) {
  // Replace with a server request to set the voted status
}

      
      */
    </script> -->
  </body>
</html>
