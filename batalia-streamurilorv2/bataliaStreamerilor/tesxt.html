<!DOCTYPE html>
<html>
<head>
    <title>User Status</title>
    <style>
        .user-row {
            display: flex;
            justify-content: space-between;
            border: 1px solid #ccc;
            padding: 5px;
            margin-bottom: 5px;
        }
        .user-info {
            flex: 2;
            display: flex;
            align-items: center;
        }
        .user-status {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div id="dynamicTable"></div>

    <script>
        var userToCheck = "masrtian";
        var apiUrl = "https://casino-promo.netbet.ro/scripts/streamers/get.php?srv=check_user&user=" + userToCheck;
        var optinUrl = "https://casino-promo.netbet.ro/scripts/streamers/get.php?srv=optin_user&user=" + userToCheck;

        // Function to create a user row with data using <div> elements
        function createUserRow(user, status, optin) {
            var dynamicTable = document.getElementById("dynamicTable");
            var userRow = document.createElement("div");
            userRow.classList.add("user-row");

            var userInfo = document.createElement("div");
            userInfo.classList.add("user-info");
            userInfo.innerHTML = `
                <div class="avatar">
                    <!-- You can add user avatar here -->
                </div>
                <div class="user-details">
                    <p class="mb-0">${user}</p>
                    <p class="text-muted mb-0">Status: ${status}</p>
                </div>
            `;

            var userStatus = document.createElement("div");
            userStatus.classList.add("user-status");
            userStatus.textContent = optin;

            userRow.appendChild(userInfo);
            userRow.appendChild(userStatus);
            dynamicTable.appendChild(userRow);
        }

        // Make an XMLHttpRequest to the first API
        var xhr = new XMLHttpRequest();
        xhr.open("GET", apiUrl, true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    console.log(data);
                    if (data.usertocheck === "name") {
                        console.log("User 'name' was found in the API response.");

                        // Make a fetch request to the opt-in API
                        fetch(optinUrl)
                            .then(function (optinResponse) {
                                if (optinResponse.status === 200) {
                                    return optinResponse.text();
                                } else {
                                    throw new Error("Opt-in API request failed with status: " + optinResponse.status);
                                }
                            })
                            .then(function (optinData) {
                                if (optinData.includes("optin=true")) {
                                    console.log("User is opted in.");
                                    createUserRow(userToCheck, "Checked", "Opted In");
                                } else if (optinData.includes("optin=false")) {
                                    console.log("User is not opted in.");
                                    createUserRow(userToCheck, "Checked", "Not Opted In");
                                    alert("User is not opted in");
                                } else {
                                    console.log("Unable to determine opt-in status.");
                                    createUserRow(userToCheck, "Checked", "Unknown Opt-in Status");
                                }
                            })
                            .catch(function (error) {
                                console.error(error);
                            });
                    } else {
                        console.log("User 'name' was not found in the API response.");
                        createUserRow(userToCheck, "Not Checked", "N/A");
                        // Handle the case where the user is not found in the "check_user" API
                    }
                } else {
                    console.error("API request failed with status: " + xhr.status);
                }
            }
        };
        xhr.send();
    </script>
</body>
</html>
