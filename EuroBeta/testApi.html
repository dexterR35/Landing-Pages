<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odds Table</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <style>
        *,
        *::after,
        *::before {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: stretch;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            font-family: sans-serif;
        }

        /* .dataTables_wrapper {
            width: 80%;
            margin: auto;
            margin-top: 20px;
        } */

        table.dataTable {
            border-collapse: collapse;
            width: 100%;
            /* border: 1px solid #ddd; */
        }
        table.dataTable thead tr th {
            background: transparent;
            font-size: 1.1em;
        }
        table.dataTable thead tr {
            background: crimson;
            color: white;
        }

        table.dataTable th,
        table.dataTable td {
            /* border: 1px solid #ddd; */
            padding: 2px;
        }
        table.dataTable tr th,
        table.dataTable td th{
            text-align: start;
        }

        table.dataTable th {
            background-color: #f2f2f2;
            text-align: center;
        }
        table.dataTable thead th, table.dataTable thead td {
            padding: 8px 10px;
        }



        .wrapper_all {
        width: 90%;
        margin: 0 auto;
   
    }


    .container-Game {
        display: flex;
        justify-content: center;
        flex-direction: row;
        align-items: start;
        width: 100%;
        height: 100%;
    }

    .team {
        /* display: flex; */
        width: 100%;
        height: 100%;
        /* background: red; */
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }
/* 
    .team:nth-child(1),
    .team:nth-child(3) {
        height: 55%;
      
    } */

    .team_center {
        background: rgb(134, 211, 10);
        height: 100%;
        width: 50%;
    }

    .team p {
    background: blueviolet;
    width: 100%;
    height: 80%;
    font-size: 1.5em;
    margin: 0 auto;
    font-weight: bold;
    text-align: start;
    display: flex;
    align-items: center;
    justify-content: end;
}
.team p:not(.timeGame) {
    background-image: linear-gradient(to right top, #051937, #004d7a, #008793, #00bf72, #a8eb12);
}
.awayTeamName{
    justify-content: end;
}
    .middleContainer {
        border: 2px solid black;
        border-bottom-left-radius: 10px;
        border-bottom-right-radius: 10px;
        width: 30%;
    }
    .middleGame {
        display: flex;
        justify-content: space-between;
        flex-direction: column;
        align-items: center;
        height: 100%;
    }

    .middleGame img {
        width: 50%;
        height: 100%;
        object-fit: contain;
    }
    .middleGame p {
        font-size: 1.1em;
        font-weight: bold;
    }

    .imgFlag {
        border-radius: 60%;
        border: 2px solid red;
        overflow: hidden;
        width: 80px;
        height: 80px;
        position: absolute;
        top: 50%;
        transform: translate(-50%, -50%);
    }

    .imgFlagLeft {
        left: 0%;
    }

    .imgFlagRight {
        left: 100%;
    }

    .imgFlag img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    align-self: end;
    }
#homeTeamName {
    justify-content: start;
}








      
        .f_info{
            display: flex;
    justify-content: start;
    gap: 10px;
        }
        .f_info div {
            font-size: 1.1em;
            font-weight: bold;
        }
        .f_info img {
            width: 15px;
    height: 15px;
    border-radius: 4px;
        }
        .f_time p {
            text-align: start;
            font-size: 0.8em;
            color: #333;
            margin-top: 1px;
            text-transform: capitalize;
        }
        .f_time {
            display: flex;
            justify-content: start;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>

<body>
    <table id="tableJsBets" class="display">
  
        <tbody>
        </tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script>
        async function fetchOddsData() {
            try {
                const response = await fetch(
                    'https://casino-promo.netbet.ro/scripts/utils/event_feed_euro2024.php?lang=RO&provider_competition_id=1855'
                );
                const data = await response.json();
                return data.items;
            } catch (error) {
                console.error('Error fetching data:', error);
                return [];
            }
        }
        function parseOddsData(data) {
            return Object.values(data).map(item => ({
                home_team: item.home_team,
                away_team: item.away_team,
                starts_at: item.starts_at,
                home_odds: item.markets.match_result[0].odds_decimal,
                draw_odds: item.markets.match_result[1].odds_decimal,
                away_odds: item.markets.match_result[2].odds_decimal,
                id: item.id.replace('1-', ''), // Remove the '1-' prefix from id
                name: item.name
            }));
        }
        const flagTeams = [
    {
        name: "Belgium",
        countryCode: "be",
    },
    {
        name: "Slovakia",
        countryCode: "sk",
    },
    {
        name: "Romania",
        countryCode: "ro",
    },
    {
        name: "Ukraine",
        countryCode: "ua",
    },
];
       
        const updatedFlagTeams = flagTeams.map(team => {
    return {
        ...team,
        flag: `https://flagcdn.com/w20/${team.countryCode}.png`
    };
});
        function getFlag(teamName) {
            const team = updatedFlagTeams.find(t => t.name === teamName);
            console.log(team,"team");
            console.log(updatedFlagTeams,"updatedFlagTeams");
            console.log(teamName,"teamName");
            return team ? team.flag : '';
        }

        function generateLink(name, id) {
            const formattedName = name.toLowerCase().replace(/ /g, '-');
            return `https://sport.netbet.ro/fotbal/european-championship/${formattedName}-${id}/`;
        }

        function filterGamesByDate(data, date) {
            return data.filter(item => item.starts_at.split(' ')[0] === date);
        }

        function getRandomGame(data) {
            const randomIndex = Math.floor(Math.random() * data.length);
            return data[randomIndex];
        }

        function createCurrentGameDiv(game) {
            return `
            <div id="currentGame" class="wrapper_all">
    <div class="container-Game">
        <div class="team team_left" id="homeTeam">
            <div class="imgFlag imgFlagLeft">
                <img src="https://flagcdn.com/w20/ua.png" alt="flag">
            </div>
            <p id="homeTeamName">${game.home_team}</p>
        </div>
        <div class="middleContainer team team_center">
            <div class="middleGame">
                <p>Time</p>
                <p class="timeGame" id="timeGame">${game.starts_at.split(' ')[1]}</p>
                <img src="./png/elements/nbLogoWhite.png"/>
            </div>
        </div>
        <div class="team team_right" id="awayTeam">
            <p id="awayTeamName">${game.away_team}</p>
            <div class="imgFlag imgFlagLeft">
                <img src="https://flagcdn.com/w20/away_flag.png" alt="flag"/>
            </div>
        </div>
    </div>
</div>
            `;
        }

        function displayCurrentGame(game) {
            const currentGameDiv = createCurrentGameDiv(game);
            const currentGameElement = document.getElementById('currentGame');
            if (currentGameElement) {
                currentGameElement.outerHTML = currentGameDiv;
            } else {
                document.body.insertAdjacentHTML('afterbegin', currentGameDiv);
            }
        }

        function checkAndDisplayGame(parsedData, date) {
            const todayGames = filterGamesByDate(parsedData, date);
            if (todayGames.length > 0) {
                const randomTodayGame = getRandomGame(todayGames);
                displayCurrentGame(randomTodayGame);
            } else {
                const upcomingGames = parsedData.filter(item => new Date(item.starts_at) > new Date(date));
                const randomUpcomingGame = getRandomGame(upcomingGames);
                displayCurrentGame(randomUpcomingGame);
            }
        }

        async function initializeOddsTable(selector) {
            const rawData = await fetchOddsData();
            const parsedData = parseOddsData(rawData);

            // Simulated current date for testing
            const simulatedCurrentDate = new Date().toISOString().split('T')[0]; // Replace with your simulated date for testing

            checkAndDisplayGame(parsedData, simulatedCurrentDate);

            setInterval(() => {
                const currentDate = new Date().toISOString().split('T')[0];
                checkAndDisplayGame(parsedData, currentDate);
            }, 24 * 60 * 60 * 1000); // Check every 24 hours

            initializeDataTableOdd(selector, parsedData);
        }

        function initializeDataTableOdd(selector, data) {
            $(selector).DataTable({
                data: data,
                columns: [
                    {
                        title: "Echipe",
                        data: null,
                        render: function(data, type, row) {
                            const homeFlag = getFlag(row.home_team);
                            const awayFlag = getFlag(row.away_team);
                            const [date, time] = row.starts_at.split(' ');
                            return `
                            <div class="f_Row">
                                <div class="f_info">
                                    <img src="${homeFlag}" alt="${row.home_team} flag" />
                                    <div>${row.home_team} vs ${row.away_team}</div>
                                    <img src="${awayFlag}" alt="${row.away_team} flag" />
                                </div>
                               
                                <div class="f_time">
                                    <p>data: ${date}</p>
                                    <p>oră: ${time}</p>
                                </div>
                            </div>
                            `;
                        }
                    },
               
                    {
                        title: "1",
                        data: "home_odds"
                    },
                    {
                        title: "X",
                        data: "draw_odds"
                    },
                    {
                        title: "2",
                        data: "away_odds"
                    }
                ],
                paging: true,
                info: true,
                lengthChange: false,
                responsive: true,
                pageLength: window.innerWidth < 991 ? 8 : 9,
                searching: false,
                ordering: false,
                createdRow: function(row, data) {
                    const link = generateLink(data.name, data.id);
                    $(row).attr('onclick', `window.location='${link}'`);
                    $(row).css('cursor', 'pointer');
                }
            });
        }

        $(document).ready(function() {
            initializeOddsTable('#tableJsBets');
        });
    </script>
</body>

</html>
